name: Container Image CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  container:
    name: build fedora-dev container
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Build container
        run: |
          podman build \
          --squash \
          --file=Containerfile \
          --tag=${{ github.repository }}:latest \
          $GITHUB_WORKSPACE
      - name: Login to ghcr.io
        run: |
          podman logout --all
          podman login --username $GITHUB_ACTOR --password ${{secrets.GITHUB_TOKEN}} ghcr.io
      - name: Push container
        run: |
          local_image_id=${{ github.repository }}:latest
          remote_image_id=oci-archive:ghcr.io/${{ github.repository }}:latest
          echo $local_image_id
          echo $remote_image_id
          podman image ls
          echo podman push $local_image_id $remote_image_id
          ls -ahl
          ls -ahlR /home/runner/work/
          podman push $local_image_id $remote_image_id
